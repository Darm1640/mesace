<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="as_project_viaticos" model="ir.ui.view">
        <field name="name">as.project.viaticos</field>
        <field name="model">project.task</field>
        <field name="inherit_id" ref="project.view_task_form2" />
        <field name="arch" type="xml">
            <xpath expr="//page[@name='extra_info']" position="after">
                <page name="extra_info" string="Planificacion de viaticos"
                    attrs="{'invisible': [('as_tipo_presupuesto',  '=', 'Frecuencia')]}">
                    <header>
                        <field name="as_state_viatico" widget="statusbar" statusbar_visible="draft,to_approval,approval"
                            readonly="1" />
                        <button name="button_approval_approval" type="object" string="Para Aprobar" class="oe_highlight"
                            attrs="{'invisible': [('as_state_viatico', '!=', 'draft')]}" />
                        <button name="button_confirm_approval" type="object" string="Aprobar" class="oe_highlight"
                            attrs="{'invisible': ['|',('as_approval', '=', False),('as_state_viatico', '!=', 'to_approval')]}" />
                        <button class="btn-primary" type="action"
                            name="%(as_spectrocom_project.as_wiz_transfer_tesoreria_return)d" icon="fa-check"
                            string="Generar Desembolso" context="{'default_as_is_diff': False}" />
                        <button class="btn-primary" type="action"
                            name="%(as_spectrocom_project.as_wiz_transfer_tesoreria_return)d" icon="fa-check"
                            string="Diferencia" context="{'default_as_is_diff': True}" />
                    </header>
                    <group col="6">
                        <field name="as_fecha_salida" />
                        <field name="as_fecha_llegada" />
                        <field name="as_presupuesto_viaticos" />
                        <field name="as_approval" invisible="True" />
                    </group>
                    <field name="as_viaticos_id">
                    <!-- lineas de viaticos en tareas para poder modifacrlas si no estan en estado aprobado -->
                        <tree string="Valuation Adjustments" editable="bottom">
                            <field name="name" invisible="1" />
                            <field name="as_empleado" attrs="{'readonly': [('as_estado', '=', 'approval')]}"/>
                            <field name="as_name" domain="[('can_be_expensed','=','True')]" attrs="{'readonly': [('as_estado', '=', 'approval')]}"/>
                            <field name="as_cant_dias" attrs="{'readonly': [('as_estado', '=', 'approval')]}"/>
                            <field name="as_precio_unitario" attrs="{'readonly': [('as_estado', '=', 'approval')]}"/>
                            <field name="as_presupuestado" sum="Total Amount" attrs="{'readonly': [('as_estado', '=', 'approval')]}"/>
                            <field name="as_ejecutado" sum="Total Amount" attrs="{'readonly': [('as_estado', '=', 'approval')]}" />
                            <field name="as_diferencia" sum="Total Amount" attrs="{'readonly': [('as_estado', '=', 'approval')]}"/>
                            <field name="as_estado" attrs="{'readonly': [('as_estado', '=', 'approval')]}"/>
                        </tree>
                    </field>
                    <group class="oe_subtotal_footer oe_right" name="project_hours">
                        <span>
                            <label class="font-weight-bold" for="as_saldo_reembolso" string="Saldo Desembolso" />
                        </span>
                        <field name="as_saldo_reembolso" class="oe_subtotal_footer_separator" nolabel="1" />
                        <span>
                            <label class="font-weight-bold" for="as_saldo_diferencia_negativa" string="Saldo Diferencia Negativa" />
                        </span>
                        <field name="as_saldo_diferencia_negativa" class="oe_subtotal_footer_separator" nolabel="1" />
                        <span>
                            <label class="font-weight-bold" for="as_saldo_diferencia" string="Saldo Diferencia" />
                        </span>
                        <field name="as_saldo_diferencia" class="oe_subtotal_footer_separator" nolabel="1" />
                    </group>

                </page>
            </xpath>
        </field>
    </record>
</odoo>